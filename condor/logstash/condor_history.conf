input {
  redis {
    host => "db.mwt2.org"
    key => "osg-connect-history"
    data_type => "channel"
    codec => json { }
  }
}


output {
    if !("_grokparsefailure" in [tags]) {
        elasticsearch {
            protocol => "http"
            host => "uct2-es-door.mwt2.org"
            index => "HISTORY_INDEX"
            index_type => "history_record"
            cluster => "dataanalytics"

        }
#        stdout { codec => rubydebug }
    }
#    if ("_grokparsefailure" in [tags]) {
#        stdout { codec => json }
#    }
}


filter {
    date {
        match => ["CompletionDate", "UNIX"]
    }
    mutate {
        convert => [ "AutoClusterId", "integer" ]
        convert => [ "BlockReadKbytes", "integer" ]
        convert => [ "BlockReads", "integer" ]
        convert => [ "BlockWritesKbytes", "integer" ]
        convert => [ "BlockWrites", "integer" ]
        convert => [ "BufferBlockSize", "integer" ]
        convert => [ "BufferSize", "integer" ]
        convert => [ "BytesRecvd", "integer" ]
        convert => [ "BytesSent", "integer" ]
        convert => [ "ClusterId", "integer" ]
        convert => [ "CommittedSlotTime", "integer" ]
        convert => [ "CommittedSuspensionTime", "integer" ]
        convert => [ "CommittedTime", "integer" ]
        convert => [ "CompletionDate", "integer" ]
        convert => [ "CoreSize", "integer" ]
        convert => [ "CumulativeSlotTime", "integer" ]
        convert => [ "CumulativeSuspensionTime", "integer" ]
        convert => [ "CurrentHosts", "integer" ]
        convert => [ "DAGManJobId", "integer" ]
        convert => [ "DiskUsage", "integer" ]
        convert => [ "DiskUsage_RAW", "integer" ]
        convert => [ "EnteredCurrentStatus", "integer" ]
        convert => [ "ExecutableSize", "integer" ]
        convert => [ "ExecutableSize_RAW", "integer" ]
        convert => [ "ExitCode", "integer" ]
        convert => [ "ExitSignal", "integer" ]
        convert => [ "ExitStatus", "integer" ]
        convert => [ "ImageSize", "integer" ]
        convert => [ "ImageSize_RAW", "integer" ]
        convert => [ "JobCurrentStartDate", "integer" ]
        convert => [ "JobCurrentStartExecutingDate", "integer" ]
        convert => [ "JobFinishedHookDone", "integer" ]
        convert => [ "JobLastStartDate", "integer" ]
        convert => [ "JobLeaseDuration", "integer" ]
        convert => [ "JobNotification", "integer" ]
        convert => [ "JobPrio", "integer" ]
        convert => [ "JobRunCount", "integer" ]
        convert => [ "JobStartDate", "integer" ]
        convert => [ "KeepClaimIdle", "integer" ]
        convert => [ "LastHoldReasonCode", "integer" ]
        convert => [ "LastHoldReasonSubCode", "integer" ]
        convert => [ "LastJobLeaseRenewal", "integer" ]
        convert => [ "LastJobStatus", "integer" ]
        convert => [ "LastMatchTime", "integer" ]
        convert => [ "LastRejMatchTime", "integer" ]
        convert => [ "LastSuspensionTime", "integer" ]
        convert => [ "LastVacateTime", "integer" ]
        convert => [ "LocalSysCpu", "integer" ]
        convert => [ "LocalUserCpu", "integer" ]
        convert => [ "MachineAttrCpus0", "integer" ]
        convert => [ "MachineAttrSlotWeight0", "integer" ]
        convert => [ "OrigMaxHosts", "integer" ]
        convert => [ "MaxHosts", "integer" ]
        convert => [ "MinHosts", "integer" ]
        convert => [ "NumCkpts", "integer" ]
        convert => [ "NumCkpts_RAW", "integer" ]
        convert => [ "NumJobMatches", "integer" ]
        convert => [ "NumJobReconnects", "integer" ]
        convert => [ "NumJobStarts", "integer" ]
        convert => [ "NumRestarts", "integer" ]
        convert => [ "NumShadowExceptions", "integer" ]
        convert => [ "NumShadowStarts", "integer" ]
        convert => [ "ProcId", "integer" ]
        convert => [ "QDate", "integer" ]
        convert => [ "Rank", "integer" ]
        convert => [ "RecentBlockReadKbytes", "integer" ]
        convert => [ "RecentBlockReads", "integer" ]
        convert => [ "RecentBlockWritesKbytes", "integer" ]
        convert => [ "RecentBlockWrites", "integer" ]
        convert => [ "RecentStatsLifetimeStarter", "integer" ]
        convert => [ "RemoteSysCpu", "integer" ]
        convert => [ "RemoteUserCpu", "integer" ]
    }
    mutate {
        convert => [ "RemoteWallClockTime", "integer" ]
        convert => [ "RequestCpus", "integer" ]
        convert => [ "RequestDisk", "integer" ]
        convert => [ "RequestMemory", "integer" ]
        convert => [ "ResidentSetSize", "integer" ]
        convert => [ "ResidentSetSize_RAW", "integer" ]
        convert => [ "StatsLifetimeStarter", "integer" ]
        convert => [ "TotalSuspensions", "integer" ]
        convert => [ "TransferInputSizeMB", "integer" ]
        convert => [ "RecentStatsLifetimeStarter", "integer" ]
        convert => [ "RemoteSysCpu", "integer" ]
        convert => [ "RemoteUserCpu", "integer" ]
    }


}


